"use strict";(self.webpackChunkai_humanoid_robotics_book=self.webpackChunkai_humanoid_robotics_book||[]).push([[216],{3763:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"modules/module-01-ros2-fundamentals/chapter-02-pubsub","title":"Chapter 2: Publisher-Subscriber Pattern","description":"Master ROS 2 topics for asynchronous communication between nodes using the publish-subscribe pattern","source":"@site/docs/modules/module-01-ros2-fundamentals/chapter-02-pubsub.md","sourceDirName":"modules/module-01-ros2-fundamentals","slug":"/modules/module-01-ros2-fundamentals/chapter-02-pubsub","permalink":"/AI-Humanoid-Robotics-Book/docs/modules/module-01-ros2-fundamentals/chapter-02-pubsub","draft":false,"unlisted":false,"editUrl":"https://github.com/asadaligith/AI-Humanoid-Robotics-Book/tree/main/docs/modules/module-01-ros2-fundamentals/chapter-02-pubsub.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Chapter 2: Publisher-Subscriber Pattern","description":"Master ROS 2 topics for asynchronous communication between nodes using the publish-subscribe pattern","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"1\ufe0f\u20e3 Introduction & Installation","permalink":"/AI-Humanoid-Robotics-Book/docs/modules/module-01-ros2-fundamentals/chapter-01-introduction"},"next":{"title":"3\ufe0f\u20e3 ROS 2 Packages","permalink":"/AI-Humanoid-Robotics-Book/docs/modules/module-01-ros2-fundamentals/chapter-03-packages"}}');var i=s(4848),t=s(8453);const o={title:"Chapter 2: Publisher-Subscriber Pattern",description:"Master ROS 2 topics for asynchronous communication between nodes using the publish-subscribe pattern",sidebar_position:2},l="Chapter 2: Publisher-Subscriber Pattern",a={},c=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Introduction",id:"introduction",level:2},{value:"When to Use Pub/Sub",id:"when-to-use-pubsub",level:3},{value:"Topic Communication Architecture",id:"topic-communication-architecture",level:2},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:3},{value:"Creating a Publisher",id:"creating-a-publisher",level:2},{value:"Python Publisher Example",id:"python-publisher-example",level:3},{value:"Creating a Subscriber",id:"creating-a-subscriber",level:2},{value:"Python Subscriber Example",id:"python-subscriber-example",level:3},{value:"Running Publisher-Subscriber",id:"running-publisher-subscriber",level:2},{value:"Introspection Tools",id:"introspection-tools",level:2},{value:"Inspecting Topics",id:"inspecting-topics",level:3},{value:"Visualizing Topic Graph",id:"visualizing-topic-graph",level:3},{value:"Custom Message Types",id:"custom-message-types",level:2},{value:"Exercise",id:"exercise",level:2},{value:"Summary",id:"summary",level:2},{value:"Further Reading",id:"further-reading",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"chapter-2-publisher-subscriber-pattern",children:"Chapter 2: Publisher-Subscriber Pattern"})}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsx)(n.p,{children:"By the end of this chapter, you will be able to:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Create"})," ROS 2 publisher nodes to broadcast sensor data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Implement"})," subscriber nodes to process incoming messages"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Design"})," custom message types for robotics applications"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Analyze"})," topic communication using ROS 2 introspection tools"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["The publish-subscribe (pub/sub) pattern is the most common communication mechanism in ROS 2. It enables asynchronous, many-to-many data distribution where publishers send messages to named topics without knowing which subscribers (if any) will receive them",(0,i.jsx)(n.sup,{children:(0,i.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"when-to-use-pubsub",children:"When to Use Pub/Sub"}),"\n",(0,i.jsxs)(n.p,{children:["\u2705 ",(0,i.jsx)(n.strong,{children:"Use topics for"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Continuous sensor data streams (camera images, LiDAR scans, IMU data)"}),"\n",(0,i.jsx)(n.li,{children:"Robot state broadcasting (odometry, joint states)"}),"\n",(0,i.jsx)(n.li,{children:"High-frequency data (>10 Hz)"}),"\n",(0,i.jsx)(n.li,{children:"One-to-many or many-to-many communication"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u274c ",(0,i.jsx)(n.strong,{children:"Avoid topics for"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Request-response interactions (use services instead)"}),"\n",(0,i.jsx)(n.li,{children:"Long-running tasks with feedback (use actions instead)"}),"\n",(0,i.jsx)(n.li,{children:"Guaranteed delivery requirements (topics are best-effort)"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"topic-communication-architecture",children:"Topic Communication Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mermaid",children:"graph LR\n    P1[Publisher: Camera] --\x3e|/image_raw| T[Topic: /image_raw]\n    P2[Publisher: LiDAR] --\x3e|/scan| T2[Topic: /scan]\n    T --\x3e|subscribe| S1[Subscriber: Perception]\n    T --\x3e|subscribe| S2[Subscriber: Logger]\n    T2 --\x3e|subscribe| S1\n"})}),"\n",(0,i.jsx)(n.h3,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,i.jsx)(n.p,{children:"ROS 2 uses DDS QoS policies to configure communication reliability:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Policy"}),(0,i.jsx)(n.th,{children:"Sensor Data"}),(0,i.jsx)(n.th,{children:"Critical Commands"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Reliability"})}),(0,i.jsx)(n.td,{children:"Best Effort"}),(0,i.jsx)(n.td,{children:"Reliable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Durability"})}),(0,i.jsx)(n.td,{children:"Volatile"}),(0,i.jsx)(n.td,{children:"Transient Local"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"History"})}),(0,i.jsx)(n.td,{children:"Keep Last (1)"}),(0,i.jsx)(n.td,{children:"Keep Last (10)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Liveliness"})}),(0,i.jsx)(n.td,{children:"Automatic"}),(0,i.jsx)(n.td,{children:"Automatic"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-publisher",children:"Creating a Publisher"}),"\n",(0,i.jsx)(n.h3,{id:"python-publisher-example",children:"Python Publisher Example"}),"\n",(0,i.jsx)(n.p,{children:"Create a temperature sensor publisher:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32\n\nclass TemperatureSensor(Node):\n    def __init__(self):\n        super().__init__('temperature_sensor')\n        self.publisher = self.create_publisher(Float32, '/temperature', 10)\n        self.timer = self.create_timer(1.0, self.publish_temperature)  # 1 Hz\n        self.get_logger().info('Temperature sensor node started')\n\n    def publish_temperature(self):\n        msg = Float32()\n        msg.data = 25.5  # Simulated temperature in Celsius\n        self.publisher.publish(msg)\n        self.get_logger().info(f'Publishing temperature: {msg.data}\xb0C')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TemperatureSensor()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key components"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_publisher(msg_type, topic_name, qos_depth)"}),": Creates publisher"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_timer(period_sec, callback)"}),": Periodic message publishing"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"publish(msg)"}),": Sends message to topic"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"creating-a-subscriber",children:"Creating a Subscriber"}),"\n",(0,i.jsx)(n.h3,{id:"python-subscriber-example",children:"Python Subscriber Example"}),"\n",(0,i.jsx)(n.p,{children:"Create a subscriber to log temperature data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"import rclpy\nfrom rclpy.node import Node\nfrom std_msgs.msg import Float32\n\nclass TemperatureLogger(Node):\n    def __init__(self):\n        super().__init__('temperature_logger')\n        self.subscription = self.create_subscription(\n            Float32,\n            '/temperature',\n            self.temperature_callback,\n            10\n        )\n        self.get_logger().info('Temperature logger node started')\n\n    def temperature_callback(self, msg):\n        self.get_logger().info(f'Received temperature: {msg.data}\xb0C')\n\n        # Alert if temperature exceeds threshold\n        if msg.data > 30.0:\n            self.get_logger().warn(f'High temperature alert: {msg.data}\xb0C')\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = TemperatureLogger()\n    rclpy.spin(node)\n    node.destroy_node()\n    rclpy.shutdown()\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Key components"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"create_subscription(msg_type, topic_name, callback, qos_depth)"}),": Creates subscriber"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"callback(msg)"}),": Function called when message received"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"running-publisher-subscriber",children:"Running Publisher-Subscriber"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Terminal 1: Start publisher\nros2 run my_package temperature_sensor\n\n# Terminal 2: Start subscriber\nros2 run my_package temperature_logger\n"})}),"\n",(0,i.jsx)(n.h2,{id:"introspection-tools",children:"Introspection Tools"}),"\n",(0,i.jsx)(n.h3,{id:"inspecting-topics",children:"Inspecting Topics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# List all active topics\nros2 topic list\n\n# Show topic details\nros2 topic info /temperature\n\n# Echo messages in real-time\nros2 topic echo /temperature\n\n# Measure message rate\nros2 topic hz /temperature\n"})}),"\n",(0,i.jsx)(n.h3,{id:"visualizing-topic-graph",children:"Visualizing Topic Graph"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Install rqt_graph\nsudo apt install ros-humble-rqt-graph\n\n# Visualize node and topic connections\nrqt_graph\n"})}),"\n",(0,i.jsx)(n.h2,{id:"custom-message-types",children:"Custom Message Types"}),"\n",(0,i.jsx)(n.p,{children:"For complex data structures, define custom messages:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"File"}),": ",(0,i.jsx)(n.code,{children:"my_msgs/msg/SensorReading.msg"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"# Custom sensor message\nstring sensor_id\nfloat64 value\nfloat64 uncertainty\ntime stamp\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Usage"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"from my_msgs.msg import SensorReading\n\nmsg = SensorReading()\nmsg.sensor_id = 'IMU_01'\nmsg.value = 9.81\nmsg.uncertainty = 0.05\nmsg.stamp = self.get_clock().now().to_msg()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exercise",children:"Exercise"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Task"}),': Create a pair of nodes where a "robot battery" publisher sends battery percentage (0-100%) every 2 seconds, and a "battery monitor" subscriber logs warnings when battery drops below 20%.']}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Expected behavior"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Publisher sends battery level: 100%, 95%, 90%, ..., 15%, 10%"}),"\n",(0,i.jsx)(n.li,{children:"Subscriber logs all values"}),"\n",(0,i.jsx)(n.li,{children:"Subscriber warns when level < 20%"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Code Example"}),": See ",(0,i.jsx)(n.code,{children:"examples/module-01-ros2-fundamentals/example-01-pubsub/"})]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"In this chapter, you learned:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"The publish-subscribe communication pattern"}),"\n",(0,i.jsx)(n.li,{children:"How to create publishers and subscribers in Python"}),"\n",(0,i.jsx)(n.li,{children:"Topic introspection with ROS 2 CLI tools"}),"\n",(0,i.jsx)(n.li,{children:"When to use topics vs. services/actions"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Next"}),": ",(0,i.jsx)(n.a,{href:"/AI-Humanoid-Robotics-Book/docs/modules/module-01-ros2-fundamentals/chapter-03-packages",children:"Chapter 3: Creating ROS 2 Packages"})," - Learn how to organize your code into maintainable ROS 2 packages."]}),"\n",(0,i.jsx)(n.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/p/rclpy/",children:"ROS 2 Python Client Library (rclpy)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Concepts/About-Quality-of-Service-Settings.html",children:"ROS 2 QoS Policies"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://design.ros2.org/articles/ros_on_dds.html",children:"DDS-based Communication"})}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Estimated Reading Time"}),": 25 minutes\n",(0,i.jsx)(n.strong,{children:"Hands-On Time"}),": 45 minutes"]}),"\n","\n",(0,i.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,i.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,i.jsxs)(n.p,{children:['ROS 2 Documentation. "Understanding Topics." ',(0,i.jsx)(n.a,{href:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html",children:"https://docs.ros.org/en/humble/Tutorials/Beginner-CLI-Tools/Understanding-ROS2-Topics/Understanding-ROS2-Topics.html"})," ",(0,i.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>l});var r=s(6540);const i={},t=r.createContext(i);function o(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);